// Generated by CoffeeScript 1.10.0
$(function() {

  /*
  Всплытие/скрытие формы
   */
  var ajax, bg, cells, competitor, curBg, overlay, responce, tab, tabs;
  overlay = $('.overlay');
  $('.add').click(function(event) {
    event.stopPropagation();
  });
  overlay.click(function() {
    overlay.hide();
  });
  $('#show-form').click(function() {
    overlay.show();
  });
  $('#cansel').click(function() {
    overlay.hide();
  });

  /*
  Управление табами
   */
  tabs = $('.tab-container');
  tabs.each(function() {
    var a, active, firstTab, href, tab;
    a = $(this).find('ul.tabs a');
    tab = $(this).find('div.tabs-content>div');
    active = $(this).find('ul.tabs a.active').length;
    if (active === 0) {
      firstTab = $(this).find('ul.tabs li:first-child a');
      firstTab.attr({
        "class": 'active'
      });
      href = firstTab.attr("href");
      $("div#" + href).css({
        display: 'block'
      });
    }
    a.each(function() {
      $(this).on('click', function() {
        a.attr({
          "class": ''
        });
        tab.hide();
        $(this).attr({
          "class": 'active'
        });
        href = $(this).attr("href");
        $("div#" + href).css({
          display: 'block'
        });
        return false;
      });
    });
  });

  /*
  Таблица соискателей - стили, управление строками
   */
  tab = $('#competitors');
  $('#competitors tr:even').css({
    background: '#ccc'

    /*
    Таблица настроек - цвета ячеек
     */
  });
  bg = $('html');
  curBg = bg.css('background-color');
  cells = $('.color-settings td').not('.caption');
  $('#color1').css({
    'background-color': "#666"
  });
  $('#color2').css({
    'background-color': "#999"
  });
  $('#color3').css({
    'background-color': "#eee"
  });
  $('#color1').on('mouseover', function() {
    bg.css({
      'background-color': '#666'
    });
  }).on('mouseout', function() {
    bg.css({
      'background-color': curBg
    });
  }).on('click', function() {
    curBg = '#666';
    cells.text('');
    $(this).text("Текущий");
  });
  $('#color2').on('mouseover', function() {
    bg.css({
      'background-color': '#999'
    });
  }).on('mouseout', function() {
    bg.css({
      'background-color': curBg
    });
  }).on('click', function() {
    curBg = '#999';
    cells.text('');
    $(this).text("Текущий");
  });
  $('#color3').on('mouseover', function() {
    bg.css({
      'background-color': '#eee'
    });
  }).on('mouseout', function() {
    bg.css({
      'background-color': curBg
    });
  }).on('click', function() {
    curBg = '#eee';
    cells.text('');
    $(this).text("Текущий");
  });

  /*
  Создаем запрос
   */
  competitor = {
    "id": "",
    "name": "Черт",
    "surname": "Лесной"
  };
  $('#take').on('click', function() {
    ajax('/applicants', 'GET', '');
  });

  /*
  Ajax
   */
  ajax = function(uri, type, send) {
    $.ajax({
      crossDomain: true,
      url: "http://applicants-tenet.rhcloud.com/api/1/dmitry5151" + uri,
      type: type,
      data: send,
      success: function(data) {
        responce(data);
      }
    });
  };

  /*
  Обработка ответа сервера
   */
  responce = function(data) {
    var i, j, len, user;
    user = "";
    for (j = 0, len = data.length; j < len; j++) {
      i = data[j];
      user += "<tr>\n    <td></td>\n    <td>" + i.name + "</td>\n    <td>" + i.surname + "</td>\n    <td>" + i.id + "</td>\n</tr>";
    }
    $('#competitors').append(user);
  };
});
